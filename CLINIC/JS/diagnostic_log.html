<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Diagnostic Log • Cat</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link rel="stylesheet" href="../CSS/index.css" />
  <link rel="stylesheet" href="../CSS/diagnostic.css" />
  <link rel="stylesheet" href="../CSS/diagnostic_log.css" /> 
  <style>
    /* Basic style adjustments for the new page layout */
    .cat-info {
        display: flex;
        align-items: center;
        gap: 20px;
        padding: 10px 0;
        border-bottom: 1px solid #eee;
        margin-bottom: 20px;
    }
    .cat-info .initials, .cat-info .avatar {
        width: 60px;
        height: 60px;
        flex-shrink: 0; 
    }
    .cat-info h2 {
        margin: 0;
        font-size: 1.8em;
    }
    .comparison-section {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
        margin-top: 20px; 
    }
    .comparison-container {
        border: 1px solid #3c445a;
        border-radius: 8px;
        padding: 15px;
    }
    .comparison-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 10px;
    }
    .comparison-header h4 {
        margin: 0;
        font-weight: 500;
    }
    .log-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 10px;
        padding-top: 10px;
    }
    .log-header h2 {
        margin: 0;
        font-size: 1.8em;
        flex-grow: 1; 
    }
    /* --- NEW/UPDATED CONTROL STYLES --- */
    /* Styles for the single Time Range dropdown at the top */
    #time-range-select, .date-input-style {
        background-color: #22293c;
        color: #fff;
        border: 1px solid #3c445a;
        border-radius: 6px;
        padding: 8px 12px;
        appearance: none;
        min-width: 100px;
        cursor: pointer;
        font-family: inherit; 
    }
    /* Style for date inputs inside comparison containers */
    .comparison-container .date-input-style {
        padding: 6px 10px; /* Smaller padding inside the container */
        font-size: 0.9em;
        width: 150px; /* Control size */
    }
    .time-range-dropdown option {
        background-color: #22293c; 
        color: #fff;
    }

    /* Top control area now contains only the dropdown and button */
    .log-controls {
        display: flex;
        justify-content: space-between;
        align-items: flex-end; /* Align items to the bottom of the section */
        margin-bottom: 20px;
    }
    .time-range-group {
        display: flex;
        flex-direction: column;
    }
    .time-range-group label {
        display: block; 
        font-weight: bold; 
        margin-bottom: 5px;
    }


    /* --- PRIMARY BUTTON STYLE --- */
    .primary-btn, #createDiagnosticBtn {
        background-color: #007bff; /* A standard blue color for a primary button */
        color: white;
        padding: 10px 20px;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        font-size: 1em;
        font-weight: bold;
        transition: background-color 0.2s;
    }
    .primary-btn:hover, #createDiagnosticBtn:hover {
        background-color: #0056b3;
    }
    
    /* --- DIAGNOSTICS LIST STYLES --- */
    .diagnostics-list {
        margin-top: 30px;
        padding-top: 20px;
        border-top: 1px solid #3c445a;
    }
    .diagnostic-entry {
        background-color: #1a1e2a;
        padding: 15px;
        margin-bottom: 10px;
        border-radius: 8px;
        border-left: 5px solid #007bff;
        /* Enable positioning context for the ellipsis menu */
        position: relative; 
    }
    .diagnostic-entry-content {
        white-space: pre-wrap;
    }

    /* --- ELLIPSIS MENU STYLES --- */
    .ellipsis-btn {
        background: none;
        border: none;
        color: #aaa;
        font-size: 1.5em;
        cursor: pointer;
        padding: 0 5px;
        line-height: 1;
    }
    .ellipsis-btn:hover {
        color: #fff;
    }

    .ellipsis-menu {
        position: absolute;
        top: 35px; /* Position below the header */
        right: 15px;
        background-color: #22293c;
        border: 1px solid #3c445a;
        border-radius: 6px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
        z-index: 100;
        min-width: 120px;
        display: none; /* Hidden by default */
        list-style: none;
        padding: 5px 0;
        margin: 0;
    }

    .ellipsis-menu.active {
        display: block;
    }

    .ellipsis-menu li button {
        background: none;
        border: none;
        color: #ddd;
        padding: 8px 15px;
        width: 100%;
        text-align: left;
        cursor: pointer;
        font-family: inherit;
        font-size: 0.9em;
    }

    .ellipsis-menu li button:hover {
        background-color: #3c445a;
        color: #fff;
    }
    
    /* --- MODAL STYLES --- */
    .modal {
        position: fixed;
        z-index: 1000;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        overflow: auto;
        background-color: rgba(0,0,0,0.4);
        display: none;
        justify-content: center;
        align-items: center;
    }
    .modal-content, .modal-card { /* modal-card for the new confirm dialog */
        background-color: #151924;
        padding: 20px;
        border: 1px solid #3c445a;
        width: 80%;
        max-width: 600px; /* Base width for content modal */
        border-radius: 10px;
        box-shadow: 0 4px 8px 0 rgba(0,0,0,0.2);
        color: #fff;
    }
    .modal-card { /* Specific styles for the smaller confirm dialog */
        max-width: 420px;
    }
    .modal-header, .modal-head { /* modal-head for the new confirm dialog */
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 15px;
        border-bottom: 1px solid #3c445a;
        padding-bottom: 10px;
    }
    .close-btn {
        color: #aaa;
        font-size: 28px;
        font-weight: bold;
        cursor: pointer;
    }
    .close-btn:hover, .close-btn:focus {
        color: #fff;
        text-decoration: none;
        cursor: pointer;
    }
    #diagnosticText, #editDiagnosticText { /* Apply to both textareas */
        width: 100%;
        height: 150px;
        padding: 10px;
        margin-top: 10px;
        box-sizing: border-box;
        resize: vertical;
        background-color: #22293c;
        color: #fff;
        border: 1px solid #3c445a;
        border-radius: 6px;
    }
    /* Move button to the right and provide top margin */
    #saveDiagnosticBtn, #updateDiagnosticBtn {
        margin-top: 15px;
        float: right; 
    }
    /* Modal actions for the custom dialog */
    .modal-actions {
        display: flex;
        justify-content: flex-end;
        gap: 10px;
        margin-top: 15px;
    }
    .modal-actions .ghost {
        background-color: transparent;
        color: #fff;
        border: 1px solid #3c445a;
        padding: 10px 15px;
        border-radius: 6px;
        cursor: pointer;
        transition: background-color 0.2s;
    }
    .modal-actions .ghost:hover {
        background-color: #22293c;
    }


    /* --- SCROLLBAR HIDING STYLES --- */

.log-list {
    /* Set the required height and overflow (moved from JS inline style) */
    max-height: 200px; 
    overflow-y: auto;
    
    /* 1. Hide scrollbar for Firefox */
    scrollbar-width: none; 
    
    /* 2. Hide scrollbar for IE and Edge */
    -ms-overflow-style: none; 
}

/* 3. Hide scrollbar for WebKit browsers (Chrome, Safari) */
.log-list::-webkit-scrollbar {
    width: 0.5em; /* Define a narrow space for the scrollbar */
    height: 0.5em; 
}
.log-list::-webkit-scrollbar-thumb {
    background-color: transparent; /* Makes the grab handle invisible */
}
.log-list::-webkit-scrollbar-track {
    background: transparent; /* Makes the track invisible */
}
  </style>
</head>
<body>
  <aside class="sidebar">
    <div class="brand">VET • CLINIC</div>
    <nav>
      <a href="index.html">Dashboard</a>
      <a href="alert.html">Alert</a>
      <a href="record.html">Record</a>
      <a href="diagnostic.html">Diagnostic</a>
    </nav>
  </aside>

  <main class="content">
    <header class="toolbar"></header>

    <section class="log-header">
        <h2 style="margin:0">Diagnostic Log</h2>
        <a href="diagnostic.html" style="text-decoration: none; color: inherit; font-size: 1.2em;">
            &larr; Back to Cats
        </a>
    </section>

    <section id="catInfoContainer" class="cat-info">
      <div id="cat-avatar-placeholder" class="initials">?</div>
      <div>
        <h2 id="cat-name-placeholder">Loading...</h2>
        <div id="cat-details-placeholder" style="color:#666;">Breed: — | Owner: — | Reg. Date: —</div>
      </div>
    </section>

    <section class="log-controls">
        <div class="time-range-group">
            <label for="time-range-select">Comparison Time Range:</label>
            <select id="time-range-select" class="time-range-dropdown">
                <option value="day">Day</option>
                <option value="week" selected>Week</option>
                <option value="month">Month</option>
                <option value="year">Year</option>
            </select>
        </div>
        <button id="createDiagnosticBtn" class="primary-btn">Create Diagnostic</button>
    </section>
    
    <section class="comparison-section">
      <div class="comparison-container" id="current-container-wrapper">
        <div class="comparison-header">
          <h4 id="log-header-text">Current Log (Week)</h4>
          <input type="date" id="diagnostic-date" class="date-input-style">
        </div>
        <div id="current-log-container" class="heartbeat-log-placeholder">
            <p>Loading heartbeat logs...</p>
        </div>
      </div>

      <div class="comparison-container" id="comparison-container-wrapper">
        <div class="comparison-header">
          <h4 id="comp-header-text">Comparison Period (Week)</h4>
          <input type="date" id="comparison-period-date" class="date-input-style">
        </div>
        <div id="comparison-log-container" class="heartbeat-log-placeholder">
            <p>Loading comparison logs...</p>
        </div>
      </div>
    </section>
    
    <section class="comparison-section">
        <div class="comparison-container">
            <div class="comparison-header">
                <h4>Possible Diseases (Left)</h4>
            </div>
            <p>List of potential short-term or primary diagnoses based on current logs.</p>
        </div>

        <div class="comparison-container">
            <div class="comparison-header">
                <h4>Possible Diseases (Right)</h4>
            </div>
            <p>List of potential long-term or secondary diagnoses/notes.</p>
        </div>
    </section>
    
    <section class="diagnostics-list">
        <h3>Saved Diagnostics History</h3>
        <div id="diagnosticsList">
            <p>Loading diagnostics...</p>
        </div>
    </section>

    <div id="toastArea" class="toast-area" aria-live="polite" aria-atomic="true"></div>
  </main>
  
  <div id="diagnosticModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>Create New Diagnostic Entry</h2>
        <span class="close-btn">&times;</span>
      </div>
      <form id="diagnosticForm">
        <p>CAT NAME: <span id="modalCatId" style="font-weight: bold;"></span></p>
        <label for="diagnosticText" style="display: block; margin-top: 10px;">Diagnostic Notes:</label>
        <textarea id="diagnosticText" placeholder="Enter detailed diagnostic notes here..."></textarea>
        <button type="submit" id="saveDiagnosticBtn" class="primary-btn">Save Diagnostic</button>
      </form>
    </div>
  </div>


  <div id="editModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>Edit Diagnostic Entry</h2>
        <span class="close-btn edit-close-btn">&times;</span>
      </div>
      <form id="editDiagnosticForm">
        <input type="hidden" id="editDiagnosticId">
        <p>CAT NAME: <span id="editModalCatId" style="font-weight: bold;"></span></p>
        <label for="editDiagnosticText" style="display: block; margin-top: 10px;">Diagnostic Notes:</label>
        <textarea id="editDiagnosticText" placeholder="Edit diagnostic notes here..."></textarea>
        
        <button type="submit" id="updateDiagnosticBtn" class="primary-btn" style="float: right;">Update Diagnostic</button>
      </form>
    </div>
  </div>

  <div id="confirmModal" class="modal">
    <div class="modal-card" style="max-width:420px">
      <div class="modal-head">
        <h3 id="confirmTitle">Please Confirm</h3>
      </div>
      <div id="confirmMessage" style="margin:8px 0 6px;color:#cbd5e1"></div>
      <div class="modal-actions">
        <button class="ghost" id="confirmCancel">Cancel</button>
        <button class="primary-btn" id="confirmOk">Yes, Continue</button>
      </div>
    </div>
  </div>
  
  <script src="../JS/diagnostic_logs.js" defer></script>
</body>
</html>